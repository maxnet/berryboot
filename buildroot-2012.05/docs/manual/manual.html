<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>The Buildroot user manual</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /></head><body><div xml:lang="en" class="book" title="The Buildroot user manual" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="idp102496"></a>The Buildroot user manual</h1></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="preface"><a href="#idp104864"></a></span></dt><dt><span class="chapter"><a href="#_about_buildroot">1. About Buildroot</a></span></dt><dt><span class="chapter"><a href="#_getting_buildroot">2. Getting Buildroot</a></span></dt><dt><span class="chapter"><a href="#_using_buildroot">3. Using Buildroot</a></span></dt><dd><dl><dt><span class="section"><a href="#_configuration_and_general_usage">3.1. Configuration and general usage</a></span></dt><dt><span class="section"><a href="#_offline_builds">3.2. Offline builds</a></span></dt><dt><span class="section"><a href="#_building_out_of_tree">3.3. Building out-of-tree</a></span></dt><dt><span class="section"><a href="#_environment_variables">3.4. Environment variables</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_customization">4. Customization</a></span></dt><dd><dl><dt><span class="section"><a href="#_customizing_the_generated_target_filesystem">4.1. Customizing the generated target filesystem</a></span></dt><dt><span class="section"><a href="#_customizing_the_busybox_configuration">4.2. Customizing the Busybox configuration</a></span></dt><dt><span class="section"><a href="#_customizing_the_uclibc_configuration">4.3. Customizing the uClibc configuration</a></span></dt><dt><span class="section"><a href="#_customizing_the_linux_kernel_configuration">4.4. Customizing the Linux kernel configuration</a></span></dt><dt><span class="section"><a href="#_customizing_the_toolchain">4.5. Customizing the toolchain</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_understanding_how_to_rebuild_packages">5. Understanding how to rebuild packages</a></span></dt><dt><span class="chapter"><a href="#_how_buildroot_works">6. How Buildroot works</a></span></dt><dt><span class="chapter"><a href="#_using_the_generated_toolchain_outside_buildroot">7. Using the generated toolchain outside Buildroot</a></span></dt><dt><span class="chapter"><a href="#_using_an_external_toolchain">8. Using an external toolchain</a></span></dt><dt><span class="chapter"><a href="#_using_literal_ccache_literal_in_buildroot">9. Using <code class="literal">ccache</code> in Buildroot</a></span></dt><dt><span class="chapter"><a href="#_location_of_downloaded_packages">10. Location of downloaded packages</a></span></dt><dt><span class="chapter"><a href="#_adding_new_packages_to_buildroot">11. Adding new packages to Buildroot</a></span></dt><dd><dl><dt><span class="section"><a href="#_package_directory">11.1. Package directory</a></span></dt><dt><span class="section"><a href="#_infrastructure_for_packages_with_specific_build_systems">11.2. Infrastructure for packages with specific build systems</a></span></dt><dt><span class="section"><a href="#_infrastructure_for_autotools_based_packages">11.3. Infrastructure for autotools-based packages</a></span></dt><dt><span class="section"><a href="#_infrastructure_for_cmake_based_packages">11.4. Infrastructure for CMake-based packages</a></span></dt><dt><span class="section"><a href="#handwritten-tutorial">11.5. Manual Makefile</a></span></dt><dt><span class="section"><a href="#_gettext_integration_and_interaction_with_packages">11.6. Gettext integration and interaction with packages</a></span></dt><dt><span class="section"><a href="#_conclusion">11.7. Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_appendix">12. Appendix</a></span></dt><dd><dl><dt><span class="section"><a href="#makedev-syntax">12.1. Makedev syntax documentation</a></span></dt></dl></dd></dl></div><div class="preface"><div class="titlepage"><div><div><h2 class="title"><a id="idp104864"></a></h2></div></div></div><p>Buildroot usage and documentation by Thomas Petazzoni. Contributions
from Karsten Kruse, Ned Ludd, Martin Herren and others.</p><div class="informalfigure"><div class="mediaobject"><img src="logo.png" alt="logo.png" /></div></div></div><div class="chapter" title="Chapter 1. About Buildroot"><div class="titlepage"><div><div><h2 class="title"><a id="_about_buildroot"></a>Chapter 1. About Buildroot</h2></div></div></div><p>Buildroot is a set of Makefiles and patches that allows you to easily
generate a cross-compilation toolchain, a root filesystem and a Linux
kernel image for your target. Buildroot can be used for one, two or
all of these options, independently.</p><p>Buildroot is useful mainly for people working with embedded systems.
Embedded systems often use processors that are not the regular x86
processors everyone is used to having in his PC. They can be PowerPC
processors, MIPS processors, ARM processors, etc.</p><p>A compilation toolchain is the set of tools that allows you to compile
code for your system. It consists of a compiler (in our case, <code class="literal">gcc</code>),
binary utils like assembler and linker (in our case, <code class="literal">binutils</code>) and a
C standard library (for example
<a class="ulink" href="http://www.gnu.org/software/libc/libc.html" target="_top">GNU Libc</a>,
<a class="ulink" href="http://www.uclibc.org/" target="_top">uClibc</a> or
<a class="ulink" href="http://www.fefe.de/dietlibc/" target="_top">dietlibc</a>). The system installed on your
development station certainly already has a compilation toolchain that
you can use to compile an application that runs on your system. If
you’re using a PC, your compilation toolchain runs on an x86 processor
and generates code for an x86 processor. Under most Linux systems, the
compilation toolchain uses the GNU libc (glibc) as the C standard
library.  This compilation toolchain is called the "host compilation
toolchain". The machine on which it is running, and on which you’re
working, is called the "host system". The compilation toolchain is
provided by your distribution, and Buildroot has nothing to do with it
(other than using it to build a cross-compilation toolchain and other
tools that are run on the development host).</p><p>As said above, the compilation toolchain that comes with your system
runs on and generates code for the processor in your host system. As
your embedded system has a different processor, you need a
cross-compilation toolchain - a compilation toolchain that runs on
your host system but generates code for your target system (and target
processor). For example, if your host system uses x86 and your target
system uses ARM, the regular compilation toolchain on your host runs on
x86 and generates code for x86, while the cross-compilation toolchain
runs on x86 and generates code for ARM.</p><p>Even if your embedded system uses an x86 processor, you might be
interested in Buildroot for two reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The compilation toolchain on your host certainly uses the GNU Libc
  which is a complete but huge C standard library. Instead of using
  GNU Libc on your target system, you can use uClibc which is a tiny C
  standard library. If you want to use this C library, then you need a
  compilation toolchain to generate binaries linked with it. Buildroot
  can do that for you.
</li><li class="listitem">
Buildroot automates the building of a root filesystem with all
  needed tools like busybox. That makes it much easier than doing it
  by hand.
</li></ul></div><p>You might wonder why such a tool is needed when you can compile <code class="literal">gcc</code>,
<code class="literal">binutils</code>, <code class="literal">uClibc</code> and all the other tools by hand. Of course doing
so is possible but, dealing with all of the configure options and
problems of every <code class="literal">gcc</code> or <code class="literal">binutils</code> version is very time-consuming
and uninteresting.  Buildroot automates this process through the use
of Makefiles and has a collection of patches for each <code class="literal">gcc</code> and
<code class="literal">binutils</code> version to make them work on most architectures.</p><p>Moreover, Buildroot provides an infrastructure for reproducing the
build process of your kernel, cross-toolchain, and embedded root
filesystem. Being able to reproduce the build process will be useful
when a component needs to be patched or updated or when another person
is supposed to take over the project.</p></div><div class="chapter" title="Chapter 2. Getting Buildroot"><div class="titlepage"><div><div><h2 class="title"><a id="_getting_buildroot"></a>Chapter 2. Getting Buildroot</h2></div></div></div><p>Buildroot releases are made approximately every 3 months. Direct Git
access and daily snapshots are also available, if you want more
bleeding edge.</p><p>Releases are available at <a class="ulink" href="http://buildroot.net/downloads/" target="_top">http://buildroot.net/downloads/</a>.</p><p>The latest snapshot is always available at
<a class="ulink" href="http://buildroot.net/downloads/snapshots/buildroot-snapshot.tar.bz2" target="_top">http://buildroot.net/downloads/snapshots/buildroot-snapshot.tar.bz2</a>,
and previous snapshots are also available at
<a class="ulink" href="http://buildroot.net/downloads/snapshots/" target="_top">http://buildroot.net/downloads/snapshots/</a>.</p><p>To download Buildroot using Git, you can simply follow the rules
described on the "Accessing Git" page
(<a class="ulink" href="http://buildroot.net/git.html" target="_top">http://buildroot.net/git.html</a>) of the Buildroot website
(<a class="ulink" href="http://buildroot.net" target="_top">http://buildroot.net</a>).  For the impatient, here’s a quick recipe:</p><pre class="screen"> $ git clone git://git.buildroot.net/buildroot</pre></div><div class="chapter" title="Chapter 3. Using Buildroot"><div class="titlepage"><div><div><h2 class="title"><a id="_using_buildroot"></a>Chapter 3. Using Buildroot</h2></div></div></div><div class="section" title="3.1. Configuration and general usage"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_configuration_and_general_usage"></a>3.1. Configuration and general usage</h2></div></div></div><p>Buildroot has a nice configuration tool similar to the one you can
find in the <a class="ulink" href="http://www.kernel.org/" target="_top">Linux kernel</a> or in
<a class="ulink" href="http://www.busybox.net/" target="_top">Busybox</a>. Note that you can (and should) build
everything as a normal user. There is no need to be root to configure
and use Buildroot. The first step is to run the configuration
assistant:</p><pre class="screen"> $ make menuconfig</pre><p>to run the curses-based configurator, or</p><pre class="screen"> $ make xconfig</pre><p>or</p><pre class="screen"> $ make gconfig</pre><p>to run the Qt or GTK-based configurators.</p><p>All of these "make" commands will need to build a configuration
utility, so you may need to install "development" packages for
relevant libraries used by the configuration utilities. On Debian-like
systems, the <code class="literal">libncurses5-dev</code> package is required to use the
<span class="emphasis"><em>menuconfig</em></span> interface, <code class="literal">libqt4-dev</code> is required to use the <span class="emphasis"><em>xconfig</em></span>
interface, and <code class="literal">libglib2.0-dev, libgtk2.0-dev and libglade2-dev</code> are
needed to use the <span class="emphasis"><em>gconfig</em></span> interface.</p><p>For each menu entry in the configuration tool, you can find associated
help that describes the purpose of the entry.</p><p>Once everything is configured, the configuration tool generates a
<code class="literal">.config</code> file that contains the description of your
configuration. It will be used by the Makefiles to do what’s needed.</p><p>Let’s go:</p><pre class="screen"> $ make</pre><p>You <span class="strong"><strong>should never</strong></span> use <code class="literal">make -jN</code> with Buildroot: it does not support
<span class="emphasis"><em>top-level parallel make</em></span>. Instead, use the <code class="literal">BR2_JLEVEL</code> option to
tell Buildroot to run each package compilation with <code class="literal">make -jN</code>.</p><p>This command will generally perform the following steps:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Download source files (as required)
</li><li class="listitem">
Configure, build and install the cross-compiling toolchain if an
  internal toolchain is used, or import a toolchain if an external
  toolchain is used
</li><li class="listitem">
Build/install selected target packages
</li><li class="listitem">
Build a kernel image, if selected
</li><li class="listitem">
Build a bootloader image, if selected
</li><li class="listitem">
Create a root filesystem in selected formats
</li></ul></div><p>Buildroot output is stored in a single directory, <code class="literal">output/</code>.
This directory contains several subdirectories:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">images/</code> where all the images (kernel image, bootloader and root
  filesystem images) are stored.
</li><li class="listitem">
<code class="literal">build/</code> where all the components except for the cross-compilation
  toolchain are built (this includes tools needed to run Buildroot on
  the host and packages compiled for the target). The <code class="literal">build/</code>
  directory contains one subdirectory for each of these components.
</li><li class="listitem">
<code class="literal">staging/</code> which contains a hierarchy similar to a root filesystem
  hierarchy. This directory contains the installation of the
  cross-compilation toolchain and all the userspace packages selected
  for the target. However, this directory is <span class="emphasis"><em>not</em></span> intended to be
  the root filesystem for the target: it contains a lot of development
  files, unstripped binaries and libraries that make it far too big
  for an embedded system. These development files are used to compile
  libraries and applications for the target that depend on other
  libraries.
</li><li class="listitem">
<code class="literal">target/</code> which contains <span class="emphasis"><em>almost</em></span> the complete root filesystem for
  the target: everything needed is present except the device files in
  <code class="literal">/dev/</code> (Buildroot can’t create them because Buildroot doesn’t run
  as root and doesn’t want to run as root). Therefore, this directory
  <span class="strong"><strong>should not be used on your target</strong></span>.  Instead, you should use one of
  the images built in the <code class="literal">images/</code> directory. If you need an
  extracted image of the root filesystem for booting over NFS, then
  use the tarball image generated in <code class="literal">images/</code> and extract it as
  root. Compared to <code class="literal">staging/</code>, <code class="literal">target/</code> contains only the files and
  libraries needed to run the selected target applications: the
  development files (headers, etc.) are not present, unless the
  <code class="literal">development files in target filesystem</code> option is selected.
</li><li class="listitem">
<code class="literal">host/</code> contains the installation of tools compiled for the host
  that are needed for the proper execution of Buildroot, including the
  cross-compilation toolchain.
</li><li class="listitem">
<code class="literal">toolchain/</code> contains the build directories for the various
  components of the cross-compilation toolchain.
</li></ul></div></div><div class="section" title="3.2. Offline builds"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_offline_builds"></a>3.2. Offline builds</h2></div></div></div><p>If you intend to do an offline build and just want to download
all sources that you previously selected in the configurator
(<span class="emphasis"><em>menuconfig</em></span>, <span class="emphasis"><em>xconfig</em></span> or <span class="emphasis"><em>gconfig</em></span>), then issue:</p><pre class="screen"> $ make source</pre><p>You can now disconnect or copy the content of your <code class="literal">dl</code>
directory to the build-host.</p></div><div class="section" title="3.3. Building out-of-tree"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_building_out_of_tree"></a>3.3. Building out-of-tree</h2></div></div></div><p>Buildroot supports building out of tree with a syntax similar to the
Linux kernel. To use it, add <code class="literal">O=&lt;directory&gt;</code> to the make command line:</p><pre class="screen"> $ make O=/tmp/build</pre><p>Or:</p><pre class="screen"> $ cd /tmp/build; make O=$PWD -C path/to/buildroot</pre><p>All the output files will be located under <code class="literal">/tmp/build</code>.</p><p>When using out-of-tree builds, the Buildroot <code class="literal">.config</code> and temporary
files are also stored in the output directory. This means that you can
safely run multiple builds in parallel using the same source tree as
long as they use unique output directories.</p><p>For ease of use, Buildroot generates a Makefile wrapper in the output
directory - So after the first run, you no longer need to pass <code class="literal">O=..</code>
and <code class="literal">-C ..</code>, simply run (in the output directory):</p><pre class="screen"> $ make &lt;target&gt;</pre></div><div class="section" title="3.4. Environment variables"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_environment_variables"></a>3.4. Environment variables</h2></div></div></div><p><a id="env-vars"></a>Buildroot also honors some environment variables, when they are passed
to <code class="literal">make</code> or set in the environment:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">HOSTCXX</code>, the host C++ compiler to use
</li><li class="listitem">
<code class="literal">HOSTCC</code>, the host C compiler to use
</li><li class="listitem">
<code class="literal">UCLIBC_CONFIG_FILE=&lt;path/to/.config&gt;</code>, path to
  the uClibc configuration file, used to compile uClibc, if an
  internal toolchain is being built
</li><li class="listitem">
<code class="literal">BUSYBOX_CONFIG_FILE=&lt;path/to/.config&gt;</code>, path to
  the Busybox configuration file
</li><li class="listitem">
<code class="literal">BUILDROOT_DL_DIR</code> to override the directory in which
  Buildroot stores/retrieves downloaded files
</li></ul></div><p>An example that uses config files located in the toplevel directory and
in your $HOME:</p><pre class="screen"> $ make UCLIBC_CONFIG_FILE=uClibc.config BUSYBOX_CONFIG_FILE=$HOME/bb.config</pre><p>If you want to use a compiler other than the default <code class="literal">gcc</code>
or <code class="literal">g</code>++ for building helper-binaries on your host, then do</p><pre class="screen"> $ make HOSTCXX=g++-4.3-HEAD HOSTCC=gcc-4.3-HEAD</pre></div></div><div class="chapter" title="Chapter 4. Customization"><div class="titlepage"><div><div><h2 class="title"><a id="_customization"></a>Chapter 4. Customization</h2></div></div></div><div class="section" title="4.1. Customizing the generated target filesystem"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_customizing_the_generated_target_filesystem"></a>4.1. Customizing the generated target filesystem</h2></div></div></div><p>There are a few ways to customize the resulting target filesystem:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Customize the target filesystem directly and rebuild the image.  The
  target filesystem is available under <code class="literal">output/target/</code>.  You can
  simply make your changes here and run make afterwards - this will
  rebuild the target filesystem image. This method allows you to do
  anything to the target filesystem, but if you decide to completely
  rebuild your toolchain and tools, these changes will be lost.
</li><li class="listitem">
Create your own <span class="emphasis"><em>target skeleton</em></span>. You can start with the default
  skeleton available under <code class="literal">fs/skeleton</code> and then customize it to suit
  your needs. The <code class="literal">BR2_ROOTFS_SKELETON_CUSTOM</code> and
  <code class="literal">BR2_ROOTFS_SKELETON_CUSTOM_PATH</code> will allow you to specify the
  location of your custom skeleton. At build time, the contents of the
  skeleton are copied to output/target before any package
  installation.
</li><li class="listitem">
In the Buildroot configuration, you can specify the path to a
  post-build script, that gets called <span class="emphasis"><em>after</em></span> Buildroot builds all the
  selected software, but <span class="emphasis"><em>before</em></span> the rootfs packages are
  assembled. The destination root filesystem folder is given as the
  first argument to this script, and this script can then be used to
  copy programs, static data or any other needed file to your target
  filesystem. You should, however, use this feature with care.
  Whenever you find that a certain package generates wrong or unneeded
  files, you should fix that package rather than work around it with a
  post-build cleanup script.
</li><li class="listitem">
A special package, <span class="emphasis"><em>customize</em></span>, stored in <code class="literal">package/customize</code> can be
  used. You can put all the files that you want to see in the final
  target root filesystem in <code class="literal">package/customize/source</code>, and then
  enable this special package in the configuration system.
</li></ul></div></div><div class="section" title="4.2. Customizing the Busybox configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_customizing_the_busybox_configuration"></a>4.2. Customizing the Busybox configuration</h2></div></div></div><p><a id="busybox-custom"></a><a class="ulink" href="http://www.busybox.net/" target="_top">Busybox</a> is very configurable, and you may
want to customize it. You can follow these simple steps to do so. This
method isn’t optimal, but it’s simple, and it works:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Do an initial compilation of Buildroot, with busybox, without
  trying to customize it.
</li><li class="listitem">
Invoke <code class="literal">make busybox-menuconfig</code>.
  The nice configuration tool appears, and you can
  customize everything.
</li><li class="listitem">
Run the compilation of Buildroot again.
</li></ul></div><p>Otherwise, you can simply change the
<code class="literal">package/busybox/busybox-&lt;version&gt;.config</code> file, if you know the
options you want to change, without using the configuration tool.</p><p>If you want to use an existing config file for busybox, then see
section <a class="xref" href="#env-vars">Section 3.4, “Environment variables”</a>.</p></div><div class="section" title="4.3. Customizing the uClibc configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_customizing_the_uclibc_configuration"></a>4.3. Customizing the uClibc configuration</h2></div></div></div><p><a id="uclibc-custom"></a>Just like <a class="link" href="#busybox-custom">BusyBox</a>
<a class="xref" href="#busybox-custom">Section 4.2, “Customizing the Busybox configuration”</a>, <a class="ulink" href="http://www.uclibc.org/" target="_top">uClibc</a>
offers a lot of configuration options. They allow you to select
various functionalities depending on your needs and limitations.</p><p>The easiest way to modify the configuration of uClibc is to
follow these steps:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Do an initial compilation of Buildroot without trying to customize
  uClibc.
</li><li class="listitem">
Invoke <code class="literal">make uclibc-menuconfig</code>.  The nice configuration assistant,
  similar to the one used in the Linux kernel or Buildroot,
  appears. Make your configuration changes as appropriate.
</li><li class="listitem">
Copy the <code class="literal">$(O)/toolchain/uclibc-VERSION/.config</code> file to a different
  place (like <code class="literal">toolchain/uClibc/uClibc-myconfig.config</code>, or
  <code class="literal">board/mymanufacturer/myboard/uClibc.config</code>) and adjust the uClibc
  configuration (configuration option <code class="literal">BR2_UCLIBC_CONFIG</code>) to use this
  configuration instead of the default one.
</li><li class="listitem">
Run the compilation of Buildroot again.
</li></ul></div><p>Otherwise, you can simply change <code class="literal">toolchain/uClibc/uClibc.config</code>,
without running the configuration assistant.</p><p>If you want to use an existing config file for uclibc, then see
<a class="xref" href="#env-vars">Section 3.4, “Environment variables”</a>.</p></div><div class="section" title="4.4. Customizing the Linux kernel configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_customizing_the_linux_kernel_configuration"></a>4.4. Customizing the Linux kernel configuration</h2></div></div></div><p>The Linux kernel configuration can be customized just like
<a class="link" href="#busybox-custom">BusyBox</a>
<a class="xref" href="#busybox-custom">Section 4.2, “Customizing the Busybox configuration”</a> and <a class="link" href="#uclibc-custom">uClibc</a>
<a class="xref" href="#uclibc-custom">Section 4.3, “Customizing the uClibc configuration”</a> using
<code class="literal">make linux-menuconfig</code>. Make sure you have enabled the kernel build
in <code class="literal">make menuconfig</code> first. Once done, run <code class="literal">make</code> to (re)build
everything.</p><p>If you want to use an existing config file for Linux, then see
<a class="xref" href="#env-vars">Section 3.4, “Environment variables”</a>.</p></div><div class="section" title="4.5. Customizing the toolchain"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_customizing_the_toolchain"></a>4.5. Customizing the toolchain</h2></div></div></div><p><a id="toolchain-custom"></a>There are three distinct types of toolchain backend supported in Buildroot,
available under the menu <code class="literal">Toolchain</code>, invoking <code class="literal">make menuconfig</code>.</p><div class="section" title="4.5.1. Using the external toolchain backend"><div class="titlepage"><div><div><h3 class="title"><a id="_using_the_external_toolchain_backend"></a>4.5.1. Using the external toolchain backend</h3></div></div></div><p>There is no way of tuning an external toolchain since Buildroot does not
generate it.</p><p>It also requires to set the Buildroot settings according to the toolchain ones
(see <a class="xref" href="#external-toolchain">Chapter 8, <em>Using an external toolchain</em></a>).</p></div><div class="section" title="4.5.2. Using the internal Buildroot toolchain backend"><div class="titlepage"><div><div><h3 class="title"><a id="_using_the_internal_buildroot_toolchain_backend"></a>4.5.2. Using the internal Buildroot toolchain backend</h3></div></div></div><p>The internal Buildroot toolchain backend <span class="strong"><strong>only</strong></span> allows to generate
<span class="strong"><strong><a class="ulink" href="http://www.uclibc.org/" target="_top">uClibc</a>-based toolchains</strong></span>.</p><p>However, it allows to tune major settings, such as:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Linux header version
</li><li class="listitem">
<a class="ulink" href="http://www.uclibc.org/" target="_top">uClibc</a> configuration (see <a class="link" href="#uclibc-custom">uClibc</a>
<a class="xref" href="#uclibc-custom">Section 4.3, “Customizing the uClibc configuration”</a>)
</li><li class="listitem">
Binutils, GCC, Gdb and toolchain options
</li></ul></div><p>This is directly available after selecting the <code class="literal">Buildroot toolchain</code> type in
the menu <code class="literal">Toolchain</code>.</p></div><div class="section" title="4.5.3. Using the Crosstool-NG backend"><div class="titlepage"><div><div><h3 class="title"><a id="_using_the_crosstool_ng_backend"></a>4.5.3. Using the Crosstool-NG backend</h3></div></div></div><p>The <a class="ulink" href="http://crosstool-ng.org" target="_top">crosstool-NG</a> toolchain backend enables a rather
limited set of settings under the Buildroot <code class="literal">Toolchain</code> menu (ie. when invoking
<code class="literal">make menuconfig</code>); mostly:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <a class="ulink" href="http://crosstool-ng.org" target="_top">crosstool-NG</a> configuration file
</li><li class="listitem">
Gdb and some toolchain options
</li></ul></div><p>Then, the toolchain can be finely tuned invoking <code class="literal">make ctng-menuconfig</code>.</p></div></div></div><div class="chapter" title="Chapter 5. Understanding how to rebuild packages"><div class="titlepage"><div><div><h2 class="title"><a id="_understanding_how_to_rebuild_packages"></a>Chapter 5. Understanding how to rebuild packages</h2></div></div></div><p>One of the most common questions asked by Buildroot users is how to
rebuild a given package or how to remove a package without rebuilding
everything from scratch.</p><p>Removing a package is currently unsupported by Buildroot without
rebuilding from scratch. This is because Buildroot doesn’t keep track
of which package installs what files in the <code class="literal">output/staging</code> and
<code class="literal">output/target</code> directories. However, implementing clean package
removal is on the TODO-list of Buildroot developers.</p><p>The easiest way to rebuild a single package from scratch is to remove
its build directory in <code class="literal">output/build</code>. Buildroot will then re-extract,
re-configure, re-compile and re-install this package from scratch.</p><p>For convenience, most packages support the special make targets
&lt;package&gt;-reconfigure and &lt;package&gt;-rebuild to repeat the configure
and build steps.</p><p>However, if you don’t want to rebuild the package completely from
scratch, a better understanding of the Buildroot internals is
needed. Internally, to keep track of which steps have been done and
which steps remain to be done, Buildroot maintains stamp files (empty
files that just tell whether this or that action has been done). The
problem is that these stamp files are not uniformly named and handled
by the different packages, so some understanding of the particular
package is needed.</p><p>For packages relying on Buildroot packages infrastructures (see
<a class="link" href="#">this section</a>
<a class="xref" href="#">???</a> for details), the following stamp
files are relevant:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">output/build/packagename-version/.stamp_configured</code>. If removed,
  Buildroot will trigger the recompilation of the package from the
  configuration step (execution of <code class="literal">./configure</code>).
</li><li class="listitem">
<code class="literal">output/build/packagename-version/.stamp_built</code>. If removed,
  Buildroot will trigger the recompilation of the package from the
  compilation step (execution of <code class="literal">make</code>).
</li></ul></div><p>For other packages, an analysis of the specific <span class="emphasis"><em>package.mk</em></span> file is
needed. For example, the zlib Makefile used to look like this (before
it was converted to the generic package infrastructure):</p><pre class="screen">$(ZLIB_DIR)/.configured: $(ZLIB_DIR)/.patched
        (cd $(ZLIB_DIR); rm -rf config.cache; \
                [...]
        )
        touch $@

$(ZLIB_DIR)/libz.a: $(ZLIB_DIR)/.configured
        $(MAKE) -C $(ZLIB_DIR) all libz.a
        touch -c $@</pre><p>If you want to trigger the reconfiguration, you need to remove
<code class="literal">output/build/zlib-version/.configured</code>. If you want to trigger only
the recompilation, you need to remove
<code class="literal">output/build/zlib-version/libz.a</code>.</p><p>Note that most packages, if not all, will progressively be ported over
to the generic or autotools infrastructure, making it much easier to
rebuild individual packages.</p></div><div class="chapter" title="Chapter 6. How Buildroot works"><div class="titlepage"><div><div><h2 class="title"><a id="_how_buildroot_works"></a>Chapter 6. How Buildroot works</h2></div></div></div><p>As mentioned above, Buildroot is basically a set of Makefiles that
download, configure, and compile software with the correct options. It
also includes patches for various software packages - mainly the ones
involved in the cross-compilation tool chain (<code class="literal">gcc</code>, <code class="literal">binutils</code> and
<code class="literal">uClibc</code>).</p><p>There is basically one Makefile per software package, and they are
named with the <code class="literal">.mk</code> extension. Makefiles are split into three main
sections:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>toolchain</strong></span> (in the <code class="literal">toolchain/</code> directory) contains the Makefiles
  and associated files for all software related to the
  cross-compilation toolchain: <code class="literal">binutils</code>, <code class="literal">gcc</code>, <code class="literal">gdb</code>,
  <code class="literal">kernel-headers</code> and <code class="literal">uClibc</code>.
</li><li class="listitem">
<span class="strong"><strong>package</strong></span> (in the <code class="literal">package/</code> directory) contains the Makefiles and
  associated files for all user-space tools that Buildroot can compile
  and add to the target root filesystem. There is one sub-directory
  per tool.
</li><li class="listitem">
<span class="strong"><strong>target</strong></span> (in the <code class="literal">target</code> directory) contains the Makefiles and
  associated files for software related to the generation of the
  target root filesystem image. Four types of filesystems are
  supported: ext2, jffs2, cramfs and squashfs. For each of them there
  is a sub-directory with the required files. There is also a
  <code class="literal">default/</code> directory that contains the target filesystem skeleton.
</li></ul></div><p>Each directory contains at least 2 files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">something.mk</code> is the Makefile that downloads, configures,
  compiles and installs the package <code class="literal">something</code>.
</li><li class="listitem">
<code class="literal">Config.in</code> is a part of the configuration tool
  description file. It describes the options related to the
  package.
</li></ul></div><p>The main Makefile performs the following steps (once the
configuration is done):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Create all the output directories: <code class="literal">staging</code>, <code class="literal">target</code>, <code class="literal">build</code>,
  <code class="literal">stamps</code>, etc. in the output directory (<code class="literal">output/</code> by default,
  another value can be specified using <code class="literal">O=</code>)
</li><li class="listitem">
Generate all the targets listed in the <code class="literal">BASE_TARGETS</code> variable. When
  an internal toolchain is used, this means generating the
  cross-compilation toolchain. When an external toolchain is used,
  this means checking the features of the external toolchain and
  importing it into the Buildroot environment.
</li><li class="listitem">
Generate all the targets listed in the <code class="literal">TARGETS</code> variable. This
  variable is filled by all the individual components'
  Makefiles. Generating these targets will trigger the compilation of
  the userspace packages (libraries, programs), the kernel, the
  bootloader and the generation of the root filesystem images,
  depending on the configuration.
</li></ul></div></div><div class="chapter" title="Chapter 7. Using the generated toolchain outside Buildroot"><div class="titlepage"><div><div><h2 class="title"><a id="_using_the_generated_toolchain_outside_buildroot"></a>Chapter 7. Using the generated toolchain outside Buildroot</h2></div></div></div><p>You may want to compile, for your target, your own programs or other
software that are not packaged in Buildroot. In order to do this you
can use the toolchain that was generated by Buildroot.</p><p>The toolchain generated by Buildroot is located by default in
<code class="literal">output/host/</code>. The simplest way to use it is to add
<code class="literal">output/host/usr/bin/</code> to your PATH environment variable and then to
use <code class="literal">ARCH-linux-gcc</code>, <code class="literal">ARCH-linux-objdump</code>, <code class="literal">ARCH-linux-ld</code>, etc.</p><p>It is possible to relocate the toolchain - but then <code class="literal">--sysroot</code> must
be passed every time the compiler is called to tell where the
libraries and header files are.</p><p>It is also possible to generate the Buildroot toolchain in a directory
other than <code class="literal">output/host</code> by using the <code class="literal">Build options → Host dir</code>
option.  This could be useful if the toolchain must be shared with
other users.</p></div><div class="chapter" title="Chapter 8. Using an external toolchain"><div class="titlepage"><div><div><h2 class="title"><a id="_using_an_external_toolchain"></a>Chapter 8. Using an external toolchain</h2></div></div></div><p><a id="external-toolchain"></a>Using an already existing toolchain is useful for different
reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
you already have a toolchain that is known to work for your specific
  CPU
</li><li class="listitem">
you want to speed up the Buildroot build process by skipping the
  long toolchain build part
</li><li class="listitem">
the toolchain generation feature of Buildroot is not sufficiently
  flexible for you (for example if you need to generate a system with
  <span class="emphasis"><em>glibc</em></span> instead of <span class="emphasis"><em>uClibc</em></span>)
</li></ul></div><p>Buildroot supports using existing toolchains through a mechanism
called <span class="emphasis"><em>external toolchain</em></span>. The external toolchain mechanism is
enabled in the <code class="literal">Toolchain</code> menu, by selecting <code class="literal">External toolchain</code> in
<code class="literal">Toolchain type</code>.</p><p>Then, you have three solutions to use an external toolchain:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Use a predefined external toolchain profile, and let Buildroot
  download, extract and install the toolchain. Buildroot already knows
  about a few CodeSourcery toolchains for ARM, PowerPC, MIPS and
  SuperH. Just select the toolchain profile in <code class="literal">Toolchain</code> through the
  available ones. This is definitely the easiest solution.
</li><li class="listitem">
Use a predefined external toolchain profile, but instead of having
  Buildroot download and extract the toolchain, you can tell Buildroot
  where your toolchain is already installed on your system. Just
  select the toolchain profile in <code class="literal">Toolchain</code> through the available
  ones, unselect <code class="literal">Download toolchain automatically</code>, and fill the
  <code class="literal">Toolchain path</code> text entry with the path to your cross-compiling
  toolchain.
</li><li class="listitem">
Use a completely custom external toolchain. This is particularly
  useful for toolchains generated using crosstool-NG. To do this,
  select the <code class="literal">Custom toolchain</code> solution in the <code class="literal">Toolchain</code> list. You
  need to fill the <code class="literal">Toolchain path</code>, <code class="literal">Toolchain prefix</code> and <code class="literal">External
  toolchain C library</code> options. Then, you have to tell Buildroot what
  your external toolchain supports. If your external toolchain uses
  the <span class="emphasis"><em>glibc</em></span> library, you only have to tell whether your toolchain
  supports C<code class="literal"> or not. If your external toolchain uses the <span class="emphasis"><em>uclibc</em></span>
  library, then you have to tell Buildroot if it supports largefile,
  IPv6, RPC, wide-char, locale, program invocation, threads and
  C</code>. At the beginning of the execution, Buildroot will tell you if
  the selected options do not match the toolchain configuration.
</li></ul></div><p>Our external toolchain support has been tested with toolchains from
CodeSourcery, toolchains generated by
<a class="ulink" href="http://crosstool-ng.org" target="_top">crosstool-NG</a>, and toolchains generated by
Buildroot itself. In general, all toolchains that support the
<span class="emphasis"><em>sysroot</em></span> feature should work. If not, do not hesitate to contact the
developers.</p><p>We do not support toolchains from the
<a class="ulink" href="http://www.denx.de/wiki/DULG/ELDK" target="_top">ELDK</a> of Denx, for two reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The ELDK does not contain a pure toolchain (i.e just the compiler,
  binutils, the C and C++ libraries), but a toolchain that comes with
  a very large set of pre-compiled libraries and programs. Therefore,
  Buildroot cannot import the <span class="emphasis"><em>sysroot</em></span> of the toolchain, as it would
  contain hundreds of megabytes of pre-compiled libraries that are
  normally built by Buildroot.
</li><li class="listitem">
The ELDK toolchains have a completely non-standard custom mechanism
  to handle multiple library variants. Instead of using the standard
  GCC <span class="emphasis"><em>multilib</em></span> mechanism, the ARM ELDK uses different symbolic links
  to the compiler to differentiate between library variants (for ARM
  soft-float and ARM VFP), and the PowerPC ELDK compiler uses a
  <code class="literal">CROSS_COMPILE</code> environment variable. This non-standard behaviour
  makes it difficult to support ELDK in Buildroot.
</li></ul></div><p>We also do not support using the distribution toolchain (i.e the
gcc/binutils/C library installed by your distribution) as the
toolchain to build software for the target. This is because your
distribution toolchain is not a "pure" toolchain (i.e only with the
C/C++ library), so we cannot import it properly into the Buildroot
build environment. So even if you are building a system for a x86 or
x86_64 target, you have to generate a cross-compilation toolchain with
Buildroot or crosstool-NG.</p></div><div class="chapter" title="Chapter 9. Using ccache in Buildroot"><div class="titlepage"><div><div><h2 class="title"><a id="_using_literal_ccache_literal_in_buildroot"></a>Chapter 9. Using <code class="literal">ccache</code> in Buildroot</h2></div></div></div><p><a class="ulink" href="http://ccache.samba.org" target="_top">ccache</a> is a compiler cache. It stores the
object files resulting from each compilation process, and is able to
skip future compilation of the same source file (with same compiler
and same arguments) by using the pre-existing object files. When doing
almost identical builds from scratch a number of times, it can nicely
speed up the build process.</p><p><code class="literal">ccache</code> support is integrated in Buildroot. You just have to enable
<code class="literal">Enable compiler cache</code> in <code class="literal">Build options</code>. This will automatically
build <code class="literal">ccache</code> and use it for every host and target compilation.</p><p>The cache is located in <code class="literal">$HOME/.buildroot-ccache</code>. It is stored
outside of Buildroot output directory so that it can be shared by
separate Buildroot builds. If you want to get rid of the cache, simply
remove this directory.</p><p>You can get statistics on the cache (its size, number of hits,
misses, etc.) by running <code class="literal">make ccache-stats</code>.</p></div><div class="chapter" title="Chapter 10. Location of downloaded packages"><div class="titlepage"><div><div><h2 class="title"><a id="_location_of_downloaded_packages"></a>Chapter 10. Location of downloaded packages</h2></div></div></div><p>It might be useful to know that the various tarballs that are
downloaded by the Makefiles are all stored in the <code class="literal">DL_DIR</code> which by
default is the <code class="literal">dl</code> directory. It’s useful, for example, if you want
to keep a complete version of Buildroot which is known to be working
with the associated tarballs. This will allow you to regenerate the
toolchain and the target filesystem with exactly the same versions.</p><p>If you maintain several Buildroot trees, it might be better to have a
shared download location. This can be accessed by creating a symbolic
link from the <code class="literal">dl</code> directory to the shared download location:</p><pre class="screen"> $ ln -s &lt;shared download location&gt; dl</pre><p>Another way of accessing a shared download location is to create the
<code class="literal">BUILDROOT_DL_DIR</code> environment variable.  If this is set, then the
value of DL_DIR in the project is overridden. The following line
should be added to <code class="literal">&lt;~/.bashrc&gt;</code>.</p><pre class="screen"> $ export BUILDROOT_DL_DIR &lt;shared download location&gt;</pre></div><div class="chapter" title="Chapter 11. Adding new packages to Buildroot"><div class="titlepage"><div><div><h2 class="title"><a id="_adding_new_packages_to_buildroot"></a>Chapter 11. Adding new packages to Buildroot</h2></div></div></div><p>This section covers how new packages (userspace libraries or
applications) can be integrated into Buildroot. It also shows how
existing packages are integrated, which is needed for fixing issues or
tuning their configuration.</p><div class="section" title="11.1. Package directory"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_package_directory"></a>11.1. Package directory</h2></div></div></div><p>First of all, create a directory under the <code class="literal">package</code> directory for
your software, for example <code class="literal">libfoo</code>.</p><p>Some packages have been grouped by topic in a sub-directory:
<code class="literal">multimedia</code>, <code class="literal">java</code>, <code class="literal">x11r7</code>, and <code class="literal">games</code>. If your package fits in
one of these categories, then create your package directory in these.</p><div class="section" title="11.1.1. Config.in file"><div class="titlepage"><div><div><h3 class="title"><a id="_literal_config_in_literal_file"></a>11.1.1. <code class="literal">Config.in</code> file</h3></div></div></div><p>Then, create a file named <code class="literal">Config.in</code>. This file will contain the
option descriptions related to our <code class="literal">libfoo</code> software that will be used
and displayed in the configuration tool. It should basically contain:</p><pre class="screen">config BR2_PACKAGE_LIBFOO
        bool "libfoo"
        help
          This is a comment that explains what libfoo is.

          http://foosoftware.org/libfoo/</pre><p>The <code class="literal">bool</code> line, <code class="literal">help</code> line and other meta-informations about the
configuration option must be indented with one tab. The help text
itself should be indented with one tab and two spaces, and it must
mention the upstream URL of the project.</p><p>Of course, you can add other sub-options into a <code class="literal">if
BR2_PACKAGE_LIBFOO…endif</code> statement to configure particular things
in your software. You can look at examples in other packages. The
syntax of the <code class="literal">Config.in</code> file is the same as the one for the kernel
Kconfig file. The documentation for this syntax is available at
<a class="ulink" href="http://lxr.free-electrons.com/source/Documentation/kbuild/kconfig-language.txt" target="_top">http://lxr.free-electrons.com/source/Documentation/kbuild/kconfig-language.txt</a></p><p>Finally you have to add your new <code class="literal">libfoo/Config.in</code> to
<code class="literal">package/Config.in</code> (or in a category subdirectory if you decided to
put your package in one of the existing categories). The files
included there are <span class="emphasis"><em>sorted alphabetically</em></span> per category and are <span class="emphasis"><em>NOT</em></span>
supposed to contain anything but the <span class="emphasis"><em>bare</em></span> name of the package.</p><pre class="screen">source "package/libfoo/Config.in"</pre><p>The <code class="literal">Config.in</code> file of your package must also ensure that
dependencies are enabled. Typically, Buildroot uses the following
rules:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Use a <code class="literal">select</code> type of dependency for dependencies on
  libraries. These dependencies are generally not obvious and it
  therefore make sense to have the kconfig system ensure that the
  dependencies are selected. For example, the <span class="emphasis"><em>libgtk2</em></span> package uses
  <code class="literal">select BR2_PACKAGE_LIBGLIB2</code> to make sure this library is also
  enabled.
</li><li class="listitem">
Use a <code class="literal">depends on</code> type of dependency when the user really needs to
  be aware of the dependency. Typically, Buildroot uses this type of
  dependency for dependencies on toolchain options (large file
  support, RPC support, IPV6 support), or for dependencies on "big"
  things, such as the X.org system. In some cases, especially
  dependency on toolchain options, it is recommended to add a
  <code class="literal">comment</code> displayed when the option is not enabled, so that the user
  knows why the package is not available.
</li></ul></div><p>An example illustrates both the usage of <code class="literal">select</code> and <code class="literal">depends on</code>.</p><pre class="screen">config BR2_PACKAGE_ACL
        bool "acl"
        select BR2_PACKAGE_ATTR
        depends on BR2_LARGEFILE
        help
          POSIX Access Control Lists, which are used to define more
          fine-grained discretionary access rights for files and
          directories.
          This package also provides libacl.

          http://savannah.nongnu.org/projects/acl

comment "acl requires a toolchain with LARGEFILE support"
        depends on !BR2_LARGEFILE</pre><p>Note that these two dependency types are only transitive with the
dependencies of the same kind.</p><p>This means, in the following example:</p><pre class="screen">config BR2_PACKAGE_A
        bool "Package A"

config BR2_PACKAGE_B
        bool "Package B"
        depends on BR2_PACKAGE_A

config BR2_PACKAGE_C
        bool "Package C"
        depends on BR2_PACKAGE_B

config BR2_PACKAGE_D
        bool "Package D"
        select BR2_PACKAGE_B

config BR2_PACKAGE_E
        bool "Package E"
        select BR2_PACKAGE_D</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Selecting <code class="literal">Package C</code> will be visible if <code class="literal">Package B</code> has been
  selected, which in turn is only visible if <code class="literal">Package A</code> has been
  selected.
</li><li class="listitem">
Selecting <code class="literal">Package E</code> will select <code class="literal">Package D</code>, which will select
  <code class="literal">Package B</code>, it will not check for the dependencies of <code class="literal">Package B</code>,
  so it will not select <code class="literal">Package A</code>.
</li><li class="listitem">
Since <code class="literal">Package B</code> is selected but <code class="literal">Package A</code> is not, this violates
  the dependency of <code class="literal">Package B</code> on <code class="literal">Package A</code>.  Therefore, in such a
  situation, the transitive dependency has to be added explicitly:
</li></ul></div><pre class="screen">config BR2_PACKAGE_D
        bool "Package D"
        select BR2_PACKAGE_B
        depends on BR2_PACKAGE_A

config BR2_PACKAGE_E
        bool "Package E"
        select BR2_PACKAGE_D
        depends on BR2_PACKAGE_A</pre><p>Overall, for package library dependencies, <code class="literal">select</code> should be
preferred.</p><p>Note that such dependencies will make sure that the dependency option
is also enabled, but not necessarily built before your package. To do
so, the dependency also needs to be expressed in the <code class="literal">.mk</code> file of the
package.</p></div><div class="section" title="11.1.2. The .mk file"><div class="titlepage"><div><div><h3 class="title"><a id="_the_literal_mk_literal_file"></a>11.1.2. The <code class="literal">.mk</code> file</h3></div></div></div><p>Finally, here’s the hardest part. Create a file named <code class="literal">libfoo.mk</code>. It
describes how the package should be downloaded, configured, built,
installed, etc.</p><p>Depending on the package type, the <code class="literal">.mk</code> file must be written in a
different way, using different infrastructures:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong>Makefiles for generic packages</strong></span> (not using autotools or CMake):
  These are based on an infrastructure similar to the one used for
  autotools-based packages, but requires a little more work from the
  developer. They specify what should be done for the configuration,
  compilation, installation and cleanup of the package. This
  infrastructure must be used for all packages that do not use the
  autotools as their build system. In the future, other specialized
  infrastructures might be written for other build systems.  We cover
  them through in a <a class="link" href="#gentargets-tutorial" title="11.2.1. GENTARGETS Tutorial">tutorial</a>
<a class="xref" href="#gentargets-tutorial" title="11.2.1. GENTARGETS Tutorial">Section 11.2.1, “<code class="literal">GENTARGETS</code> Tutorial”</a> and a
  <a class="link" href="#gentargets-reference" title="11.2.2. GENTARGETS Reference">reference</a>
<a class="xref" href="#gentargets-reference" title="11.2.2. GENTARGETS Reference">Section 11.2.2, “<code class="literal">GENTARGETS</code> Reference”</a>.
</li><li class="listitem">
<span class="strong"><strong>Makefiles for autotools-based software</strong></span> (autoconf, automake, etc.):
  We provide a dedicated infrastructure for such packages, since
  autotools is a very common build system. This infrastructure <span class="emphasis"><em>must</em></span>
  be used for new packages that rely on the autotools as their build
  system. We cover them through a <a class="link" href="#autotargets-tutorial" title="11.3.1. AUTOTARGETS tutorial">tutorial</a>
<a class="xref" href="#autotargets-tutorial" title="11.3.1. AUTOTARGETS tutorial">Section 11.3.1, “<code class="literal">AUTOTARGETS</code> tutorial”</a>
  and <a class="link" href="#autotargets-reference" title="11.3.2. AUTOTARGETS reference">reference</a>
<a class="xref" href="#autotargets-reference" title="11.3.2. AUTOTARGETS reference">Section 11.3.2, “<code class="literal">AUTOTARGETS</code> reference”</a>.
</li><li class="listitem">
<span class="strong"><strong>Makefiles for cmake-based software</strong></span>: We provide a dedicated
   infrastructure for such packages, as CMake is a more and more
   commonly used build system and has a standardized behaviour. This
   infrastructure <span class="emphasis"><em>must</em></span> be used for new packages that rely on
   CMake. We cover them through a <a class="link" href="#cmaketargets-tutorial" title="11.4.1. CMAKETARGETS tutorial">tutorial</a>
<a class="xref" href="#cmaketargets-tutorial" title="11.4.1. CMAKETARGETS tutorial">Section 11.4.1, “<code class="literal">CMAKETARGETS</code> tutorial”</a>
   and <a class="link" href="#cmaketargets-reference" title="11.4.2. CMAKETARGETS reference">reference</a>
<a class="xref" href="#cmaketargets-reference" title="11.4.2. CMAKETARGETS reference">Section 11.4.2, “<code class="literal">CMAKETARGETS</code> reference”</a>.
</li><li class="listitem">
<span class="strong"><strong>Hand-written Makefiles:</strong></span> These are currently obsolete, and no new
  manual Makefiles should be added. However, since there are still
  many of them in the tree, we keep them documented in a
  <a class="link" href="#handwritten-tutorial" title="11.5. Manual Makefile">tutorial</a>
<a class="xref" href="#handwritten-tutorial" title="11.5. Manual Makefile">Section 11.5, “Manual Makefile”</a>.
</li></ul></div></div></div><div class="section" title="11.2. Infrastructure for packages with specific build systems"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_infrastructure_for_packages_with_specific_build_systems"></a>11.2. Infrastructure for packages with specific build systems</h2></div></div></div><p>By <span class="emphasis"><em>packages with specific build systems</em></span> we mean all the packages
whose build system is not one of the standard ones, such as
<span class="emphasis"><em>autotools</em></span> or <span class="emphasis"><em>CMake</em></span>. This typically includes packages whose build
system is based on hand-written Makefiles or shell scripts.</p><div class="section" title="11.2.1. GENTARGETS Tutorial"><div class="titlepage"><div><div><h3 class="title"><a id="gentargets-tutorial"></a>11.2.1. <code class="literal">GENTARGETS</code> Tutorial</h3></div></div></div><pre class="screen">01: #############################################################
02: #
03: # libfoo
04: #
05: #############################################################
06: LIBFOO_VERSION = 1.0
07: LIBFOO_SOURCE = libfoo-$(LIBFOO_VERSION).tar.gz
08: LIBFOO_SITE = http://www.foosoftware.org/download
09: LIBFOO_INSTALL_STAGING = YES
10: LIBFOO_DEPENDENCIES = host-libaaa libbbb
11:
12: define LIBFOO_BUILD_CMDS
13:     $(MAKE) CC="$(TARGET_CC)" LD="$(TARGET_LD)" -C $(@D) all
14: endef
15:
16: define LIBFOO_INSTALL_STAGING_CMDS
17:     $(INSTALL) -D -m 0755 $(@D)/libfoo.a $(STAGING_DIR)/usr/lib/libfoo.a
18:     $(INSTALL) -D -m 0644 $(@D)/foo.h $(STAGING_DIR)/usr/include/foo.h
19:     $(INSTALL) -D -m 0755 $(@D)/libfoo.so* $(STAGING_DIR)/usr/lib
20: endef
21:
22: define LIBFOO_INSTALL_TARGET_CMDS
23:     $(INSTALL) -D -m 0755 $(@D)/libfoo.so* $(TARGET_DIR)/usr/lib
24:     $(INSTALL) -d -m 0755 $(TARGET_DIR)/etc/foo.d
25: endef
26:
27: define LIBFOO_DEVICES
28:     /dev/foo  c  666  0  0  42  0  -  -  -
29: endef
30:
31: define LIBFOO_PERMISSIONS
32:     /bin/foo  f  4755  0  0  -  -  -  -  -
33: endef
34:
35: $(eval $(call GENTARGETS))</pre><p>The Makefile begins on line 6 to 8 with metadata information: the
version of the package (<code class="literal">LIBFOO_VERSION</code>), the name of the
tarball containing the package (<code class="literal">LIBFOO_SOURCE</code>) and the
Internet location at which the tarball can be downloaded
(<code class="literal">LIBFOO_SITE</code>). All variables must start with the same prefix,
<code class="literal">LIBFOO_</code> in this case. This prefix is always the uppercased
version of the package name (see below to understand where the package
name is defined).</p><p>On line 9, we specify that this package wants to install something to
the staging space. This is often needed for libraries, since they must
install header files and other development files in the staging space.
This will ensure that the commands listed in the
<code class="literal">LIBFOO_INSTALL_STAGING_CMDS</code> variable will be executed.</p><p>On line 10, we specify the list of dependencies this package relies
on. These dependencies are listed in terms of lower-case package names,
which can be packages for the target (without the <code class="literal">host-</code>
prefix) or packages for the host (with the <code class="literal">host-</code>) prefix).
Buildroot will ensure that all these packages are built and installed
<span class="emphasis"><em>before</em></span> the current package starts its configuration.</p><p>The rest of the Makefile defines what should be done at the different
steps of the package configuration, compilation and installation.
<code class="literal">LIBFOO_BUILD_CMDS</code> tells what steps should be performed to
build the package. <code class="literal">LIBFOO_INSTALL_STAGING_CMDS</code> tells what
steps should be performed to install the package in the staging space.
<code class="literal">LIBFOO_INSTALL_TARGET_CMDS</code> tells what steps should be
performed to install the package in the target space.</p><p>All these steps rely on the <code class="literal">$(@D)</code> variable, which
contains the directory where the source code of the package has been
extracted.</p><p>Finally, on line 35, we call the <code class="literal">GENTARGETS</code> which
generates, according to the variables defined previously, all the
Makefile code necessary to make your package working.</p></div><div class="section" title="11.2.2. GENTARGETS Reference"><div class="titlepage"><div><div><h3 class="title"><a id="gentargets-reference"></a>11.2.2. <code class="literal">GENTARGETS</code> Reference</h3></div></div></div><p>The <code class="literal">GENTARGETS</code> macro takes one optional argument. This argument can
be used to tell if the package is a target package (cross-compiled for
the target) or a host package (natively compiled for the host). If
unspecified, it is assumed that it is a target package. See below for
details.</p><p>For a given package, in a single <code class="literal">.mk</code> file, it is possible to call
GENTARGETS twice, once to create the rules to generate a target
package and once to create the rules to generate a host package:</p><pre class="screen">$(eval $(call GENTARGETS))
$(eval $(call GENTARGETS,host))</pre><p>This might be useful if the compilation of the target package requires
some tools to be installed on the host. If the package name is
<code class="literal">libfoo</code>, then the name of the package for the target is also
<code class="literal">libfoo</code>, while the name of the package for the host is
<code class="literal">host-libfoo</code>. These names should be used in the DEPENDENCIES
variables of other packages, if they depend on <code class="literal">libfoo</code> or
<code class="literal">host-libfoo</code>.</p><p>The call to the <code class="literal">GENTARGETS</code> macro <span class="strong"><strong>must</strong></span> be at the end of the <code class="literal">.mk</code>
file, after all variable definitions.</p><p>For the target package, the <code class="literal">GENTARGETS</code> uses the variables defined by
the .mk file and prefixed by the uppercased package name:
<code class="literal">LIBFOO_*</code>. For the host package, it uses the <code class="literal">HOST_LIBFOO_*</code>. For
<span class="emphasis"><em>some</em></span> variables, if the <code class="literal">HOST_LIBFOO_</code> prefixed variable doesn’t
exist, the package infrastructure uses the corresponding variable
prefixed by <code class="literal">LIBFOO_</code>. This is done for variables that are likely to
have the same value for both the target and host packages. See below
for details.</p><p>The list of variables that can be set in a <code class="literal">.mk</code> file to give metadata
information is (assuming the package name is <code class="literal">libfoo</code>) :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">LIBFOO_VERSION</code>, mandatory, must contain the version of the
  package. Note that if <code class="literal">HOST_LIBFOO_VERSION</code> doesn’t exist, it is
  assumed to be the same as <code class="literal">LIBFOO_VERSION</code>. It can also be a
  revision number, branch or tag for packages that are fetched
  directly from their revision control system.<br/>
  Examples:<br/>
    <code class="literal">LIBFOO_VERSION = 0.1.2</code><br/>
    <code class="literal">LIBFOO_VERSION = cb9d6aa9429e838f0e54faa3d455bcbab5eef057</code><br/>
    <code class="literal">LIBFOO_VERSION = stable</code>
</li><li class="listitem">
<code class="literal">LIBFOO_SOURCE</code> may contain the name of the tarball of
  the package. If <code class="literal">HOST_LIBFOO_SOURCE</code> is not specified, it
  defaults to <code class="literal">LIBFOO_SOURCE</code>. If none are specified, then
  the value is assumed to be
  <code class="literal">packagename-$(LIBFOO_VERSION).tar.gz</code>.<br/>
  Example: <code class="literal">LIBFOO_SOURCE = foobar-$(LIBFOO_VERSION).tar.bz2</code>
</li><li class="listitem">
<code class="literal">LIBFOO_PATCH</code> may contain the name of a patch, that will be
  downloaded from the same location as the tarball indicated in
  <code class="literal">LIBFOO_SOURCE</code>. If <code class="literal">HOST_LIBFOO_PATCH</code> is not specified, it
  defaults to <code class="literal">LIBFOO_PATCH</code>. Also note that another mechanism is
  available to patch a package: all files of the form
  <code class="literal">packagename-packageversion-description.patch</code> present in the
  package directory inside Buildroot will be applied to the package
  after extraction.
</li><li class="listitem">
<code class="literal">LIBFOO_SITE</code> may contain the Internet location of the package. It
  can either be the HTTP, FTP or SCP location of a tarball, or the URL
  of a Git, Subversion, Mercurial or Bazaar repository (see
  <code class="literal">LIBFOO_SITE_METHOD</code> below).<br/>
  SCP URLs should be of the form <code class="literal">scp://[user@]host:filepath</code>. Note
  that filepath is relative to the user’s home directory, so you may want
  to prepend the path with a slash for absolute paths:
  <code class="literal">scp://[user@]host:/absolutepath</code>.<br/>
  If <code class="literal">HOST_LIBFOO_SITE</code> is not specified, it defaults to
  <code class="literal">LIBFOO_SITE</code>. If none are specified, then the location is assumed
  to be
  <code class="literal">http://$$(BR2_SOURCEFORGE_MIRROR).dl.sourceforge.net/sourceforge/packagename</code>.<br/>
  Examples:<br/>
    <code class="literal">LIBFOO_SITE=http://www.libfoosoftware.org/libfoo</code><br/>
    <code class="literal">LIBFOO_SITE=http://svn.xiph.org/trunk/Tremor/</code><br/>
    <code class="literal">LIBFOO_SITE=git://github.com/kergoth/tslib.git</code>
</li><li class="listitem">
<code class="literal">LIBFOO_SITE_METHOD</code> may contain the method to fetch the package
  source code. It can either be <code class="literal">wget</code> (for normal FTP/HTTP downloads
  of tarballs), <code class="literal">scp</code> (for downloads over SSH with scp), <code class="literal">svn</code>, <code class="literal">git</code>,
  <code class="literal">hg</code> or <code class="literal">bzr</code>.  When not specified, it is guessed from the URL given
  in <code class="literal">LIBFOO_SITE</code>: <code class="literal">scp://</code>, <code class="literal">svn://</code>, <code class="literal">git://</code> and
  <code class="literal">bzr://</code> URLs will use the <code class="literal">scp</code>, <code class="literal">svn</code>, <code class="literal">git</code> and <code class="literal">bzr</code> methods
  respectively. All other URL-types will use the <code class="literal">wget</code> method. So for
  example, in the case of a package whose source code is available
  through a Subversion repository on HTTP, one <span class="emphasis"><em>must</em></span> specifiy
  <code class="literal">LIBFOO_SITE_METHOD=svn</code>. Similarly, for Mercurial repositories, one
  <span class="emphasis"><em>must</em></span> specify <code class="literal">LIBFOO_SITE_METHOD=hg</code>. For <code class="literal">svn</code>, <code class="literal">git</code>, <code class="literal">hg</code> and
  <code class="literal">bzr</code> methods, what Buildroot does is a checkout/clone of the repository
  which is then tarballed and stored into the download cache. Next
  builds will not checkout/clone again, but will use the tarball directly.
  When <code class="literal">HOST_LIBFOO_SITE_METHOD</code> is not specified, it defaults to the value
  of <code class="literal">LIBFOO_SITE_METHOD</code>. See <code class="literal">package/multimedia/tremor/</code> for an
  example.
</li><li class="listitem">
<code class="literal">LIBFOO_DEPENDENCIES</code> lists the dependencies (in terms of package
  name) that are required for the current target package to
  compile. These dependencies are guaranteed to be compiled and
  installed before the configuration of the current package starts. In
  a similar way, <code class="literal">HOST_LIBFOO_DEPENDENCIES</code> lists the dependency for
  the current host package.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_STAGING</code> can be set to <code class="literal">YES</code> or <code class="literal">NO</code> (default). If
  set to <code class="literal">YES</code>, then the commands in the <code class="literal">LIBFOO_INSTALL_STAGING_CMDS</code>
  variables are executed to install the package into the staging
  directory.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_TARGET</code> can be set to <code class="literal">YES</code> (default) or <code class="literal">NO</code>. If
  set to <code class="literal">YES</code>, then the commands in the <code class="literal">LIBFOO_INSTALL_TARGET_CMDS</code>
  variables are executed to install the package into the target
  directory.
</li><li class="listitem">
<code class="literal">LIBFOO_DEVICES</code> lists the device files to be created by Buildroot
  when using the static device table. The syntax to use is the
  makedevs one. You can find some documentation for this syntax in the
  <a class="xref" href="#makedev-syntax" title="12.1. Makedev syntax documentation">Section 12.1, “Makedev syntax documentation”</a>. This variable is optional.
</li><li class="listitem">
<code class="literal">LIBFOO_PERMISSIONS</code> lists the changes of permissions to be done at
  the end of the build process. The syntax is once again the makedevs one.
  You can find some documentation for this syntax in the <a class="xref" href="#makedev-syntax" title="12.1. Makedev syntax documentation">Section 12.1, “Makedev syntax documentation”</a>.
  This variable is optional.
</li></ul></div><p>The recommended way to define these variables is to use the following
syntax:</p><pre class="screen">LIBFOO_VERSION = 2.32</pre><p>Now, the variables that define what should be performed at the
different steps of the build process.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">LIBFOO_CONFIGURE_CMDS</code>, used to list the actions to be performed to
  configure the package before its compilation
</li><li class="listitem">
<code class="literal">LIBFOO_BUILD_CMDS</code>, used to list the actions to be performed to
  compile the package
</li><li class="listitem">
<code class="literal">HOST_LIBFOO_INSTALL_CMDS</code>, used to list the actions to be performed
  to install the package, when the package is a host package. The
  package must install its files to the directory given by
  <code class="literal">$(HOST_DIR)</code>. All files, including development files such as
  headers should be installed, since other packages might be compiled
  on top of this package.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_TARGET_CMDS</code>, used to list the actions to be
  performed to install the package to the target directory, when the
  package is a target package. The package must install its files to
  the directory given by <code class="literal">$(TARGET_DIR)</code>. Only the files required for
  <span class="emphasis"><em>documentation</em></span> and <span class="emphasis"><em>execution</em></span> of the package should be
  installed. Header files should not be installed, they will be copied
  to the target, if the <code class="literal">development files in target filesystem</code>
  option is selected.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_STAGING_CMDS</code>, used to list the actions to be
  performed to install the package to the staging directory, when the
  package is a target package. The package must install its files to
  the directory given by <code class="literal">$(STAGING_DIR)</code>. All development files
  should be installed, since they might be needed to compile other
  packages.
</li><li class="listitem">
<code class="literal">LIBFOO_CLEAN_CMDS</code>, used to list the actions to perform to clean up
  the build directory of the package.
</li><li class="listitem">
<code class="literal">LIBFOO_UNINSTALL_TARGET_CMDS</code>, used to list the actions to
  uninstall the package from the target directory <code class="literal">$(TARGET_DIR)</code>
</li><li class="listitem">
<code class="literal">LIBFOO_UNINSTALL_STAGING_CMDS</code>, used to list the actions to
  uninstall the package from the staging directory <code class="literal">$(STAGING_DIR)</code>.
</li></ul></div><p>The preferred way to define these variables is:</p><pre class="screen">define LIBFOO_CONFIGURE_CMDS
        action 1
        action 2
        action 3
endef</pre><p>In the action definitions, you can use the following variables:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">$(@D)</code>, which contains the directory in which the package source
  code has been uncompressed.
</li><li class="listitem">
<code class="literal">$(TARGET_CC)</code>, <code class="literal">$(TARGET_LD)</code>, etc. to get the target
  cross-compilation utilities
</li><li class="listitem">
<code class="literal">$(TARGET_CROSS)</code> to get the cross-compilation toolchain prefix
</li><li class="listitem">
Of course the <code class="literal">$(HOST_DIR)</code>, <code class="literal">$(STAGING_DIR)</code> and <code class="literal">$(TARGET_DIR)</code>
  variables to install the packages properly.
</li></ul></div><p>The last feature of the generic infrastructure is the ability to add
hooks. These define further actions to perform after existing steps.
Most hooks aren’t really useful for generic packages, since the <code class="literal">.mk</code>
file already has full control over the actions performed in each step
of the package construction. The hooks are more useful for packages
using the autotools infrastructure described below.  However, since
they are provided by the generic infrastructure, they are documented
here. The exception is <code class="literal">LIBFOO_POST_PATCH_HOOKS</code>.  Patching the
package is not user definable, so <code class="literal">LIBFOO_POST_PATCH_HOOKS</code> will be
userful for generic packages.</p><p>The following hook points are available:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">LIBFOO_POST_PATCH_HOOKS</code>
</li><li class="listitem">
<code class="literal">LIBFOO_PRE_CONFIGURE_HOOKS</code>
</li><li class="listitem">
<code class="literal">LIBFOO_POST_CONFIGURE_HOOKS</code>
</li><li class="listitem">
<code class="literal">LIBFOO_POST_BUILD_HOOKS</code>
</li><li class="listitem">
<code class="literal">LIBFOO_POST_INSTALL_HOOKS</code> (for host packages only)
</li><li class="listitem">
<code class="literal">LIBFOO_POST_INSTALL_STAGING_HOOKS</code> (for target packages only)
</li><li class="listitem">
<code class="literal">LIBFOO_POST_INSTALL_TARGET_HOOKS</code> (for target packages only)
</li></ul></div><p>These variables are <span class="emphasis"><em>lists</em></span> of variable names containing actions to be
performed at this hook point. This allows several hooks to be
registered at a given hook point. Here is an example:</p><pre class="screen">define LIBFOO_POST_PATCH_FIXUP
        action1
        action2
endef

LIBFOO_POST_PATCH_HOOKS += LIBFOO_POST_PATCH_FIXUP</pre></div></div><div class="section" title="11.3. Infrastructure for autotools-based packages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_infrastructure_for_autotools_based_packages"></a>11.3. Infrastructure for autotools-based packages</h2></div></div></div><div class="section" title="11.3.1. AUTOTARGETS tutorial"><div class="titlepage"><div><div><h3 class="title"><a id="autotargets-tutorial"></a>11.3.1. <code class="literal">AUTOTARGETS</code> tutorial</h3></div></div></div><p>First, let’s see how to write a <code class="literal">.mk</code> file for an autotools-based
package, with an example :</p><pre class="screen">01: #############################################################
02: #
03: # libfoo
04: #
05: #############################################################
06: LIBFOO_VERSION = 1.0
07: LIBFOO_SOURCE = libfoo-$(LIBFOO_VERSION).tar.gz
08: LIBFOO_SITE = http://www.foosoftware.org/download
09: LIBFOO_INSTALL_STAGING = YES
10: LIBFOO_INSTALL_TARGET = YES
11: LIBFOO_CONF_OPT = --enable-shared
12: LIBFOO_DEPENDENCIES = libglib2 host-pkg-config
13:
14: $(eval $(call AUTOTARGETS))</pre><p>On line 6, we declare the version of the package.</p><p>On line 7 and 8, we declare the name of the tarball and the location
of the tarball on the Web. Buildroot will automatically download the
tarball from this location.</p><p>On line 9, we tell Buildroot to install the package to the staging
directory. The staging directory, located in <code class="literal">output/staging/</code>
is the directory where all the packages are installed, including their
development files, etc. By default, packages are not installed to the
staging directory, since usually, only libraries need to be installed in
the staging directory: their development files are needed to compile
other libraries or applications depending on them. Also by default, when
staging installation is enabled, packages are installed in this location
using the <code class="literal">make install</code> command.</p><p>On line 10, we tell Buildroot to also install the package to the
target directory. This directory contains what will become the root
filesystem running on the target. Usually, we try not to install header
files and to install stripped versions of the binary. By default, target
installation is enabled, so in fact, this line is not strictly
necessary. Also by default, packages are installed in this location
using the <code class="literal">make install</code> command.</p><p>On line 11, we tell Buildroot to pass a custom configure option, that
will be passed to the <code class="literal">./configure</code> script before configuring
and building the package.</p><p>On line 12, we declare our dependencies, so that they are built
before the build process of our package starts.</p><p>Finally, on line line 14, we invoke the <code class="literal">AUTOTARGETS</code>
macro that generates all the Makefile rules that actually allows the
package to be built.</p></div><div class="section" title="11.3.2. AUTOTARGETS reference"><div class="titlepage"><div><div><h3 class="title"><a id="autotargets-reference"></a>11.3.2. <code class="literal">AUTOTARGETS</code> reference</h3></div></div></div><p>The main macro of the autotools package infrastructure is
<code class="literal">AUTOTARGETS</code>. It has the same number of arguments and the
same semantic as the <code class="literal">GENTARGETS</code> macro, which is the main
macro of the generic package infrastructure. For autotools packages, the
ability to have target and host packages is also available (and is
actually widely used).</p><p>Just like the generic infrastructure, the autotools infrastructure
works by defining a number of variables before calling the
<code class="literal">AUTOTARGETS</code> macro.</p><p>First, all the package metadata information variables that exist in the
generic infrastructure also exist in the autotools infrastructure:
<code class="literal">LIBFOO_VERSION</code>, <code class="literal">LIBFOO_SOURCE</code>,
<code class="literal">LIBFOO_PATCH</code>, <code class="literal">LIBFOO_SITE</code>,
<code class="literal">LIBFOO_SUBDIR</code>, <code class="literal">LIBFOO_DEPENDENCIES</code>,
<code class="literal">LIBFOO_INSTALL_STAGING</code>, <code class="literal">LIBFOO_INSTALL_TARGET</code>.</p><p>A few additional variables, specific to the autotools infrastructure,
can also be defined. Many of them are only useful in very specific
cases, typical packages will therefore only use a few of them.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">LIBFOO_SUBDIR</code> may contain the name of a subdirectory
  inside the package that contains the configure script. This is useful,
  if for example, the main configure script is not at the root of the
  tree extracted by the tarball. If <code class="literal">HOST_LIBFOO_SUBDIR</code> is
  not specified, it defaults to <code class="literal">LIBFOO_SUBDIR</code>.
</li><li class="listitem">
<code class="literal">LIBFOO_CONF_ENV</code>, to specify additional environment
  variables to pass to the configure script. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_CONF_OPT</code>, to specify additional configure
  options to pass to the configure script. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_MAKE</code>, to specify an alternate <code class="literal">make</code>
  command. This is typically useful when parallel make is enabled in
  the configuration (using <code class="literal">BR2_JLEVEL</code>) but that this
  feature should be disabled for the given package, for one reason or
  another. By default, set to <code class="literal">$(MAKE)</code>. If parallel building
  is not supported by the package, then it should be set to
  <code class="literal">LIBFOO_MAKE=$(MAKE1)</code>.
</li><li class="listitem">
<code class="literal">LIBFOO_MAKE_ENV</code>, to specify additional environment
  variables to pass to make in the build step. These are passed before
  the <code class="literal">make</code> command. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_MAKE_OPT</code>, to specify additional variables to
  pass to make in the build step. These are passed after the
  <code class="literal">make</code> command. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_AUTORECONF</code>, tells whether the package should
  be autoreconfigured or not (i.e, if the configure script and
  Makefile.in files should be re-generated by re-running autoconf,
  automake, libtool, etc.). Valid values are <code class="literal">YES</code> and
  <code class="literal">NO</code>. By default, the value is <code class="literal">NO</code>
</li><li class="listitem">
<code class="literal">LIBFOO_AUTORECONF_OPT</code> to specify additional options
  passed to the <span class="emphasis"><em>autoreconf</em></span> program if
  <code class="literal">LIBFOO_AUTORECONF=YES</code>. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_LIBTOOL_PATCH</code> tells whether the Buildroot
  patch to fix libtool cross-compilation issues should be applied or
  not. Valid values are <code class="literal">YES</code> and <code class="literal">NO</code>. By
  default, the value is <code class="literal">YES</code>
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_STAGING_OPT</code> contains the make options
  used to install the package to the staging directory. By default, the
  value is <code class="literal">DESTDIR=$$(STAGING_DIR) install</code>, which is
  correct for most autotools packages. It is still possible to override
  it.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_TARGET_OPT</code> contains the make options
  used to install the package to the target directory. By default, the
  value is <code class="literal">DESTDIR=$$(TARGET_DIR) install</code>. The default
  value is correct for most autotools packages, but it is still possible
  to override it if needed.
</li><li class="listitem">
<code class="literal">LIBFOO_CLEAN_OPT</code> contains the make options used to
  clean the package. By default, the value is <code class="literal">clean</code>.
</li><li class="listitem">
<code class="literal">LIBFOO_UNINSTALL_STAGING_OPT</code>, contains the make
  options used to uninstall the package from the staging directory. By
  default, the value is <code class="literal">DESTDIR=$$(STAGING_DIR) uninstall</code>.
</li><li class="listitem">
<code class="literal">LIBFOO_UNINSTALL_TARGET_OPT</code>, contains the make
  options used to uninstall the package from the target directory. By
  default, the value is <code class="literal">DESTDIR=$$(TARGET_DIR) uninstall</code>.
</li></ul></div><p>With the autotools infrastructure, all the steps required to build
and install the packages are already defined, and they generally work
well for most autotools-based packages. However, when required, it is
still possible to customize what is done in any particular step:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
By adding a post-operation hook (after extract, patch, configure,
  build or install). See the reference documentation of the generic
  infrastructure for details.
</li><li class="listitem">
By overriding one of the steps. For example, even if the autotools
  infrastructure is used, if the package <code class="literal">.mk</code> file defines its
  own <code class="literal">LIBFOO_CONFIGURE_CMDS</code> variable, it will be used
  instead of the default autotools one. However, using this method
  should be restricted to very specific cases. Do not use it in the
  general case.
</li></ul></div></div></div><div class="section" title="11.4. Infrastructure for CMake-based packages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_infrastructure_for_cmake_based_packages"></a>11.4. Infrastructure for CMake-based packages</h2></div></div></div><div class="section" title="11.4.1. CMAKETARGETS tutorial"><div class="titlepage"><div><div><h3 class="title"><a id="cmaketargets-tutorial"></a>11.4.1. <code class="literal">CMAKETARGETS</code> tutorial</h3></div></div></div><p>First, let’s see how to write a <code class="literal">.mk</code> file for a CMake-based package,
with an example :</p><pre class="screen">01: #############################################################
02: #
03: # libfoo
04: #
05: #############################################################
06: LIBFOO_VERSION = 1.0
07: LIBFOO_SOURCE = libfoo-$(LIBFOO_VERSION).tar.gz
08: LIBFOO_SITE = http://www.foosoftware.org/download
09: LIBFOO_INSTALL_STAGING = YES
10: LIBFOO_INSTALL_TARGET = YES
11: LIBFOO_CONF_OPT = -DBUILD_DEMOS=ON
12: LIBFOO_DEPENDENCIES = libglib2 host-pkg-config
13:
14: $(eval $(call CMAKETARGETS))</pre><p>On line 6, we declare the version of the package.</p><p>On line 7 and 8, we declare the name of the tarball and the location
of the tarball on the Web. Buildroot will automatically download the
tarball from this location.</p><p>On line 9, we tell Buildroot to install the package to the staging
directory. The staging directory, located in <code class="literal">output/staging/</code>
is the directory where all the packages are installed, including their
development files, etc. By default, packages are not installed to the
staging directory, since usually, only libraries need to be installed in
the staging directory: their development files are needed to compile
other libraries or applications depending on them. Also by default, when
staging installation is enabled, packages are installed in this location
using the <code class="literal">make install</code> command.</p><p>On line 10, we tell Buildroot to also install the package to the
target directory. This directory contains what will become the root
filesystem running on the target. Usually, we try not to install header
files and to install stripped versions of the binary. By default, target
installation is enabled, so in fact, this line is not strictly
necessary. Also by default, packages are installed in this location
using the <code class="literal">make install</code> command.</p><p>On line 11, we tell Buildroot to pass custom options to CMake when it is
configuring the package.</p><p>On line 12, we declare our dependencies, so that they are built
before the build process of our package starts.</p><p>Finally, on line line 14, we invoke the <code class="literal">CMAKETARGETS</code>
macro that generates all the Makefile rules that actually allows the
package to be built.</p></div><div class="section" title="11.4.2. CMAKETARGETS reference"><div class="titlepage"><div><div><h3 class="title"><a id="cmaketargets-reference"></a>11.4.2. <code class="literal">CMAKETARGETS</code> reference</h3></div></div></div><p>The main macro of the CMake package infrastructure is
<code class="literal">CMAKETARGETS</code>. It has the same number of arguments and the same
semantic as the <code class="literal">GENTARGETS</code> macro, which is the main macro of the
generic package infrastructure. For CMake packages, the ability to
have target and host packages is also available.</p><p>Just like the generic infrastructure, the CMake infrastructure works
by defining a number of variables before calling the <code class="literal">CMAKETARGETS</code>
macro.</p><p>First, all the package metadata information variables that exist in
the generic infrastructure also exist in the CMake infrastructure:
<code class="literal">LIBFOO_VERSION</code>, <code class="literal">LIBFOO_SOURCE</code>, <code class="literal">LIBFOO_PATCH</code>, <code class="literal">LIBFOO_SITE</code>,
<code class="literal">LIBFOO_SUBDIR</code>, <code class="literal">LIBFOO_DEPENDENCIES</code>, <code class="literal">LIBFOO_INSTALL_STAGING</code>,
<code class="literal">LIBFOO_INSTALL_TARGET</code>.</p><p>A few additional variables, specific to the CMake infrastructure, can
also be defined. Many of them are only useful in very specific cases,
typical packages will therefore only use a few of them.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">LIBFOO_SUBDIR</code> may contain the name of a subdirectory inside the
  package that contains the main CMakeLists.txt file. This is useful,
  if for example, the main CMakeLists.txt file is not at the root of
  the tree extracted by the tarball. If <code class="literal">HOST_LIBFOO_SUBDIR</code> is not
  specified, it defaults to <code class="literal">LIBFOO_SUBDIR</code>.
</li><li class="listitem">
<code class="literal">LIBFOO_CONF_ENV</code>, to specify additional environment variables to
  pass to CMake. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_CONF_OPT</code>, to specify additional configure options to pass
  to CMake. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_MAKE</code>, to specify an alternate <code class="literal">make</code> command. This is
  typically useful when parallel make is enabled in the configuration
  (using <code class="literal">BR2_JLEVEL</code>) but that this feature should be disabled for
  the given package, for one reason or another. By default, set to
  <code class="literal">$(MAKE)</code>. If parallel building is not supported by the package,
  then it should be set to <code class="literal">LIBFOO_MAKE=$(MAKE1)</code>.
</li><li class="listitem">
<code class="literal">LIBFOO_MAKE_ENV</code>, to specify additional environment variables to
  pass to make in the build step. These are passed before the <code class="literal">make</code>
  command. By default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_MAKE_OPT</code>, to specify additional variables to pass to make
  in the build step. These are passed after the <code class="literal">make</code> command. By
  default, empty.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_STAGING_OPT</code> contains the make options used to
  install the package to the staging directory. By default, the value
  is <code class="literal">DESTDIR=$$(STAGING_DIR) install</code>, which is correct for most
  CMake packages. It is still possible to override it.
</li><li class="listitem">
<code class="literal">LIBFOO_INSTALL_TARGET_OPT</code> contains the make options used to
  install the package to the target directory. By default, the value
  is <code class="literal">DESTDIR=$$(TARGET_DIR) install</code>. The default value is correct
  for most CMake packages, but it is still possible to override it if
  needed.
</li><li class="listitem">
<code class="literal">LIBFOO_CLEAN_OPT</code> contains the make options used to clean the
  package. By default, the value is <code class="literal">clean</code>.
</li></ul></div><p>With the CMake infrastructure, all the steps required to build and
install the packages are already defined, and they generally work well
for most CMake-based packages. However, when required, it is still
possible to customize what is done in any particular step:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
By adding a post-operation hook (after extract, patch, configure,
  build or install). See the reference documentation of the generic
  infrastructure for details.
</li><li class="listitem">
By overriding one of the steps. For example, even if the CMake
  infrastructure is used, if the package <code class="literal">.mk</code> file defines its own
  <code class="literal">LIBFOO_CONFIGURE_CMDS</code> variable, it will be used instead of the
  default CMake one. However, using this method should be restricted
  to very specific cases. Do not use it in the general case.
</li></ul></div></div></div><div class="section" title="11.5. Manual Makefile"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="handwritten-tutorial"></a>11.5. Manual Makefile</h2></div></div></div><p><span class="strong"><strong>NOTE: new manual makefiles should not be created, and existing manual
makefiles should be converted either to the generic, autotools or
cmake infrastructure. This section is only kept to document the
existing manual makefiles and to help understand how they work.</strong></span></p><pre class="screen">01: #############################################################
02: #
03: # libfoo
04: #
05: #############################################################
06: LIBFOO_VERSION = 1.0
07: LIBFOO_SOURCE = libfoo-$(LIBFOO_VERSION).tar.gz
08: LIBFOO_SITE = http://www.foosoftware.org/downloads
09: LIBFOO_DIR = $(BUILD_DIR)/foo-$(FOO_VERSION)
10: LIBFOO_BINARY = foo
11: LIBFOO_TARGET_BINARY = usr/bin/foo
12:
13: $(DL_DIR)/$(LIBFOO_SOURCE):
14:     $(call DOWNLOAD,$(LIBFOO_SITE)/$(LIBFOO_SOURCE))
15:
16: $(LIBFOO_DIR)/.source: $(DL_DIR)/$(LIBFOO_SOURCE)
17:     $(ZCAT) $(DL_DIR)/$(LIBFOO_SOURCE) | tar -C $(BUILD_DIR) $(TAR_OPTIONS) -
18:     touch $@
19:
20: $(LIBFOO_DIR)/.configured: $(LIBFOO_DIR)/.source
21:     (cd $(LIBFOO_DIR); rm -rf config.cache; \
22:             $(TARGET_CONFIGURE_OPTS) \
23:             $(TARGET_CONFIGURE_ARGS) \
24:             ./configure \
25:             --target=$(GNU_TARGET_NAME) \
26:             --host=$(GNU_TARGET_NAME) \
27:             --build=$(GNU_HOST_NAME) \
28:             --prefix=/usr \
29:             --sysconfdir=/etc \
30:     )
31:     touch $@
32:
33: $(LIBFOO_DIR)/$(LIBFOO_BINARY): $(LIBFOO_DIR)/.configured
34:     $(MAKE) CC=$(TARGET_CC) -C $(LIBFOO_DIR)
35:
36: $(TARGET_DIR)/$(LIBFOO_TARGET_BINARY): $(LIBFOO_DIR)/$(LIBFOO_BINARY)
37:     $(MAKE) DESTDIR=$(TARGET_DIR) -C $(LIBFOO_DIR) install-strip
38:     rm -Rf $(TARGET_DIR)/usr/man
39:
40: libfoo: uclibc ncurses $(TARGET_DIR)/$(LIBFOO_TARGET_BINARY)
41:
42: libfoo-source: $(DL_DIR)/$(LIBFOO_SOURCE)
43:
44: libfoo-clean:
45:     $(MAKE) prefix=$(TARGET_DIR)/usr -C $(LIBFOO_DIR) uninstall
46:     -$(MAKE) -C $(LIBFOO_DIR) clean
47:
48: libfoo-dirclean:
49:     rm -rf $(LIBFOO_DIR)
50:
51: #############################################################
52: #
53: # Toplevel Makefile options
54: #
55: #############################################################
56: ifeq ($(BR2_PACKAGE_LIBFOO),y)
57: TARGETS += libfoo
58: endif</pre><p>First of all, this Makefile example works for a package which
comprises a single binary executable. For other software, such as
libraries or more complex stuff with multiple binaries, it must be
qqadapted. For examples look at the other <code class="literal">*.mk</code> files in the
<code class="literal">package</code> directory.</p><p>At lines 6-11, a couple of useful variables are defined:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">LIBFOO_VERSION</code>: The version of <span class="emphasis"><em>libfoo</em></span> that should be downloaded.
</li><li class="listitem">
<code class="literal">LIBFOO_SOURCE</code>: The name of the tarball of <span class="emphasis"><em>libfoo</em></span> on the download
  website or FTP site. As you can see <code class="literal">LIBFOO_VERSION</code> is used.
</li><li class="listitem">
<code class="literal">LIBFOO_SITE</code>: The HTTP or FTP site from which <span class="emphasis"><em>libfoo</em></span> archive is
  downloaded. It must include the complete path to the directory where
  <code class="literal">LIBFOO_SOURCE</code> can be found.
</li><li class="listitem">
<code class="literal">LIBFOO_DIR</code>: The directory into which the software will be
  configured and compiled. Basically, it’s a subdirectory of
  <code class="literal">BUILD_DIR</code> which is created upon decompression of the tarball.
</li><li class="listitem">
<code class="literal">LIBFOO_BINARY</code>: Software binary name. As said previously, this is
  an example for a package with a single binary.
</li><li class="listitem">
<code class="literal">LIBFOO_TARGET_BINARY</code>: The full path of the binary inside the
  target filesystem.  Lines 13-14 define a target that downloads the
  tarball from the remote site to the download directory (<code class="literal">DL_DIR</code>).
</li></ul></div><p>Lines 16-18 define a target and associated rules that uncompress the
downloaded tarball. As you can see, this target depends on the tarball
file so that the previous target (lines 13-14) is called before
executing the rules of the current target. Uncompressing is followed
by <span class="emphasis"><em>touching</em></span> a hidden file to mark the software as having been
uncompressed. This trick is used everywhere in a Buildroot Makefile to
split steps (download, uncompress, configure, compile, install) while
still having correct dependencies.</p><p>Lines 20-31 define a target and associated rules that configure the
software. It depends on the previous target (the hidden <code class="literal">.source</code>
file) so that we are sure the software has been uncompressed. In order
to configure the package, it basically runs the well-known
<code class="literal">./configure</code> script. As we may be doing cross-compilation, <code class="literal">target</code>,
<code class="literal">host</code> and <code class="literal">build</code> arguments are given. The prefix is also set to
<code class="literal">/usr</code>, not because the software will be installed in <code class="literal">/usr</code> on your
host system, but because the software will be installed in + /usr+ on
the target filesystem. Finally it creates a <code class="literal">.configured</code> file to mark
the software as configured.</p><p>Lines 33-34 define a target and a rule that compile the software. This
target will create the binary file in the compilation directory and
depends on the software being already configured (hence the reference
to the <code class="literal">.configured</code> file).  It basically runs <code class="literal">make</code> inside the
source directory.</p><p>Lines 36-38 define a target and associated rules that install the
software inside the target filesystem. They depend on the binary file
in the source directory to make sure the software has been
compiled. They use the <code class="literal">install-strip</code> target of the software
<code class="literal">Makefile</code> by passing a <code class="literal">DESTDIR</code> argument so that the <code class="literal">Makefile</code>
doesn’t try to install the software in the host <code class="literal">/usr</code> but rather in
the target <code class="literal">/usr</code>. After the installation, the +/usr/man + directory
inside the target filesystem is removed to save space.</p><p>Line 40 defines the main target of the software — the one that
will eventually be used by the top level <code class="literal">Makefile</code> to download,
compile, and then install this package. This target should first of
all depend on all needed dependencies of the software (in our example,
<span class="emphasis"><em>uclibc</em></span> and <span class="emphasis"><em>ncurses</em></span>) and also depend on the final binary. This last
dependency will call all previous dependencies in the correct order.</p><p>Line 42 defines a simple target that only downloads the code
source. This is not used during normal operation of Buildroot, but is
needed if you intend to download all required sources at once for
later offline build. Note that if you add a new package, providing a
<code class="literal">libfoo-source</code> target is <span class="emphasis"><em>mandatory</em></span> to support users that wish to do
offline-builds. Furthermore, it eases checking if all package-sources
are downloadable.</p><p>Lines 44-46 define a simple target to clean the software build by
calling the Makefile with the appropriate options.  The <code class="literal">-clean</code>
target should run <code class="literal">make clean</code> on $(BUILD_DIR)/package-version and
MUST uninstall all files of the package from $(STAGING_DIR) and from
$(TARGET_DIR).</p><p>Lines 48-49 define a simple target to completely remove the directory
in which the software was uncompressed, configured and compiled. The
<code class="literal">-dirclean</code> target MUST completely rm $(BUILD_DIR)/ package-version.</p><p>Lines 51-58 add the target <code class="literal">libfoo</code> to the list of targets to be
compiled by Buildroot, by first checking if the configuration option
for this package has been enabled using the configuration tool. If so,
it then "subscribes" this package to be compiled by adding
the package to the TARGETS global variable.  The name added to the
TARGETS global variable is the name of this package’s target, as
defined on line 40, which is used by Buildroot to download, compile,
and then install this package.</p></div><div class="section" title="11.6. Gettext integration and interaction with packages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_gettext_integration_and_interaction_with_packages"></a>11.6. Gettext integration and interaction with packages</h2></div></div></div><p>Many packages that support internationalization use the gettext
library. Dependencies for this library are fairly complicated and
therefore, deserves some explanation.</p><p>The <span class="emphasis"><em>uClibc</em></span> C library doesn’t implement gettext functionality,
therefore with this C library, a separate gettext must be compiled. On
the other hand, the <span class="emphasis"><em>glibc</em></span> C library does integrate its own gettext,
and in this case, the separate gettext library should not be compiled,
because it creates various kinds of build failures.</p><p>Additionally, some packages (such as <code class="literal">libglib2</code>) do require gettext
unconditionally, while other packages (those who support
<code class="literal">--disable-nls</code> in general) only require gettext when locale support
is enabled.</p><p>Therefore, Buildroot defines two configuration options:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">BR2_NEEDS_GETTEXT</code>, which is true as soon as the toolchain doesn’t
  provide its own gettext implementation
</li><li class="listitem">
<code class="literal">BR2_NEEDS_GETTEXT_IF_LOCALE</code>, which is true if the toolchain
  doesn’t provide its own gettext implementation and if locale support
  is enabled
</li></ul></div><p>Therefore, packages that unconditionally need gettext should:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Use <code class="literal">select BR2_PACKAGE_GETTEXT if BR2_NEEDS_GETTEXT</code> and possibly
  <code class="literal">select BR2_PACKAGE_LIBINTL if BR2_NEEDS_GETTEXT</code>, if libintl is
  also needed
</li><li class="listitem">
Use <code class="literal">$(if $(BR2_NEEDS_GETTEXT),gettext)</code> in the package
  <code class="literal">DEPENDENCIES</code> variable
</li></ul></div><p>Packages that need gettext only when locale support is enabled should:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Use <code class="literal">select BR2_PACKAGE_GETTEXT if BR2_NEEDS_GETTEXT_IF_LOCALE</code> and
  possibly <code class="literal">select BR2_PACKAGE_LIBINTL if
  BR2_NEEDS_GETTEXT_IF_LOCALE</code>, if libintl is also needed
</li><li class="listitem">
Use <code class="literal">$(if $(BR2_NEEDS_GETTEXT_IF_LOCALE),gettext)</code> in the package
  <code class="literal">DEPENDENCIES</code> variable
</li></ul></div></div><div class="section" title="11.7. Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_conclusion"></a>11.7. Conclusion</h2></div></div></div><p>As you can see, adding a software package to Buildroot is simply a
matter of writing a Makefile using an  existing example and modifying it
according to the compilation process required by the package.</p><p>If you package software that might be useful for other people, don’t
forget to send a patch to Buildroot developers!</p></div></div><div class="chapter" title="Chapter 12. Appendix"><div class="titlepage"><div><div><h2 class="title"><a id="_appendix"></a>Chapter 12. Appendix</h2></div></div></div><div class="section" title="12.1. Makedev syntax documentation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="makedev-syntax"></a>12.1. Makedev syntax documentation</h2></div></div></div><p>The makedev syntax is used across several places in Buildroot to
define changes to be made for permissions or which device files to
create and how to create them, in order to avoid to call mkdnod every
now and then.</p><p>This syntax is derived from the makedev utility, and a more complete
documentation can be found in the <code class="literal">package/makedevs/README</code> file.</p><p>It takes the form of a line for each file, with the following layout:</p><div class="informaltable"><table cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; "><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /><col class="col_5" /><col class="col_6" /><col class="col_7" /><col class="col_8" /><col class="col_9" /><col class="col_10" /></colgroup><tbody><tr><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>name</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>type</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>mode</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>uid</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>gid</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>major</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>minor</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>start</p></td><td style="border-right: 1px solid #527bbd; " align="left" valign="top"><p>inc</p></td><td style="" align="left" valign="top"><p>count</p></td></tr></tbody></table></div><p>There is a few non-trivial blocks here:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">name</code> is the path to the file you want to create/modify
</li><li class="listitem"><p class="simpara">
<code class="literal">type</code> is the type of the file, being one of :
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
f: a regular file
</li><li class="listitem">
d: a directory
</li><li class="listitem">
c: a character device file
</li><li class="listitem">
b: a block device file
</li><li class="listitem">
p: a named pipe
</li></ul></div></li><li class="listitem">
<code class="literal">mode</code>, <code class="literal">uid</code> and <code class="literal">gid</code> are the usual permissions stuff
</li><li class="listitem">
<code class="literal">major</code> and <code class="literal">minor</code> are here for device files
</li><li class="listitem">
<code class="literal">start</code>, <code class="literal">inc</code> and <code class="literal">count</code> are when you want to create a whole batch
  of files, and can be reduced to a loop, beginning at <code class="literal">start</code>,
  incrementing its counter by <code class="literal">inc</code> until it reaches <code class="literal">count</code>
</li></ul></div><p>Let’s say you want to change the permissions of a given file, using
this syntax, you will need to put:</p><pre class="screen">/usr/bin/foobar f       644     0       0       -       -       -       -       -</pre><p>On the other hand, if you want to create the device file <code class="literal">/dev/hda</code>
and the corresponding 15 files for the partitions, you will need for
<code class="literal">/dev/hda</code>:</p><pre class="screen">/dev/hda        b       640     0       0       3       0       0       0       -</pre><p>and then for device files corresponding to the partitions of
<code class="literal">/dev/hda</code>, <code class="literal">/dev/hdaX</code>, <code class="literal">X</code> ranging from 1 to 15:</p><pre class="screen">/dev/hda        b       640     0       0       3       1       1       1       15</pre></div></div></div></body></html>
